# Для чего этот скрипт

Скрипт нужен для мониторинга доступности поставок с бесплатной приемкой на склады Wildberries. Каждые 15 минут (время указывается в настройках триггера) отправляет запрос на сервер Wildberries, получает дату в которые доступна поставка товара на склад. Если есть доступные слотоы с бесплатной приемкой, то на указанную почту отправляется письмо с уведомлением.

___

# Начало работы

* [Создание функции](#создание-функции)
* [Настройка триггера](#настройка-триггера)
* [Логика работы скрипта](#логика-работы-скрипта)
* [Запуск скрипта](#запуск-скрипта)
* [Остановка скрипта](#остановка-скрипта)
* [Работа скрипта](#работа-скрипта)
* [Изменение параметров (cookie, почта, номер заказа)](#изменение-параметров-cookie-почта-номер-заказа)
* [Где взять cookie](#где-взять-cookie)
* [Где взять номер заказа](#где-взять-номер-заказа)


## Создание функции

1. Необходимо создать функцию python на [Yandex Cloud Functions](https://console.yandex.cloud/folders) 
2. Заменить содержимое файла `index.py` в вашей функции на содержимое файла `index.py` из данного репозитория
3. Создать в функции 2 файла - `wb_calendar.py` и `requirements.txt`, вставить в них содержимое файлов `wb_calendar.py` и `requirements.txt` из данного репозитория (не забудьте вставить актуальные куки/почту/другие параметры в файл `lamoda_checker.py`)
4. В настройках функции установить таймаут 60 секунд и сохранить изменения
![image](https://github.com/user-attachments/assets/7b72ff96-543e-4886-9ad9-751239dee50f) 
5. Сделать функцию публичной переключив тумблер в обзоре функции
![image](https://github.com/user-attachments/assets/251ebed7-2ee7-4a82-87cb-db9e51597b18)


## Настройка триггера

Создать триггер, который будет запускать функцию каждые 15 минут (время на ваше усмотрение)
![image](https://github.com/user-attachments/assets/84fcbbf3-58c6-4e24-9e97-7a6b8b90fa14)



## Логика

Т.к. доступность приёмки на складе может отличаться в зависимости от количество поставляемых позиций, то для корректной работы необходимо создать поставку введя примерное количество поставляемых позиций. Скрипт будет мониторить склад, который мы выберем в момент создания поставки. Мониторинг будет происходить с текущей даты на месяц вперед (т.е. запустился сейчас 21.01.2025 17:26 - будет смотреть доступные слоты с 21.01.2025 17:26  до 21.02.2025 17:26. Следующий запуск через 15 минут, в 21.01.2025 17:41, будет смотреть до 21.02.2025 17:41 и т.д.)

Пример создания поставки для выбора склада и получения номера заказа:<br>
1.	Переходим на https://seller.wildberries.ru/supplies-management/all-supplies и жмем «Новая поставка»<br>
* screen
2.	Выбираем «Выбрать из списка»<br>
* screen
3.	Ставим галочку рядом с каким-нибудь товаром, вводим необходимое количество, и жмем кнопку «Применить»<br>
* screen 
4.	Жмем кнопку «Дальше»<br>
* screen
5.	Выбираем нужный склад (именно доступность поставок на этот склад будет мониторить скрипт)<br>
* screen
6.	Жмем «Дальше»<br>
* screen
7.	Получаем номер заказа и список дат в которые доступна поставка на текущий момент:<br>
* screen


## Запуск скрипта

Для запуска скрипта необходимо:<br>
1.	Зайти на https://console.yandex.cloud/folders/<br>
2.	Перейти в триггеры<br>
* screen
3.	Кликнуть по триггеру<br>
* screen
4.	В правом верхнем углу нажать кнопку «Запустить»:<br>
* screen
Подтвердить действие:<br>
* screen
5.	Скрипт запущен (будет проверять доступность слотов каждые 15 минут и как только слоты станут доступны – слать письмо)

## Остановка скрипта

1.	Зайти на https://console.yandex.cloud/folders/<br>
2.	Перейти в триггеры<br>
* screen
3.	Кликнуть по триггеру<br>
* screen
4.	В правом верхнем углу нажать кнопку «Остановить»:<br>
* screen
Подтвердить действие:<br>
* screen
5.	Скрипт остановлен

## Работа скрипта

При запущенном триггере скрипт будет запускаться каждые 15 минут и проверять на доступность слотов с бесплатной приёмкой.<br>
Когда слоты станут доступны скрипт отправляет письмо на почту.<br>
Пример: <br>
* screen
Если во время работы скрипта произошла какая-то ошибка, то скрипт отправит письмо с кодом ошибки.<br>
Пример:<br>
* screen


## Изменение параметров (cookie, почта, номер заказа)

1.	Зайти на https://console.yandex.cloud/folders/<br>
2.	Перейти в функции:<br>
* screen
3.	Кликнуть по функции:<br>
* screen
4.	Нажать на раздел «Редактор»:<br>
* screen
5.	Перейти в файл `wb_calendar.py`<br>
* screen
6.	Внести необходимые изменения в параметры:<br>
* screen
7.	После внесения изменений пролистать вниз страницы и нажать на кнопку «Сохранить изменения»<br>
* screen
8.	Изменения внесены

## Где взять cookie

1.	Зайти на https://seller.wildberries.ru/supplies-management/all-supplies <br>
2.	Нажать на клавиатуре «Ctrl+Shift+E» (если браузер фаерфокс)<br>
3.	Обновить страницу (F5)<br>
4.	Нажать на запрос, который начинается со слова `listSupplies`:<br>
* screen
5.	В меню справа во вкладке «Заголовки» пролистать до пункта «Заголовки запроса» и найти строку «Cookie»:<br>
* screen
6.	Нажать ПКМ по строке «Cookie» и нажать «Копировать значение»:<br>
* screen
7.	Скопированные cookie вставить в параметры (cookie обновляются примерно раз в сутки, поэтому при запущенном скрипте необходимо раз в сутки заходить, копировать новые cookie и вставлять их в параметры скрипта)

## Где взять номер заказа?

1.	Номер заказа можно найти на странице со всеми поставками <br>
* screen

ИЛИ<br>
2.	После выбора склада в момент создания новой поставки:<br>
* screen
